<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<title>Setup K8s cluster using LKE and Terraform</title>


  



<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link
  rel="alternate"
  type="application/rss+xml"
  href="https://diabhey.github.io/index.xml"
  title="CloudOdyssey"
/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Setup K8s cluster using LKE and Terraform"/>
<meta name="twitter:description" content="In this blog post, I&rsquo;ll demonstrate how I am using Linode Kubernetes Engine(LKE) and Terraform to setup the infrastructure for Hivenetes (a personal project that I am working on). I chose Linode as the cloud provider as it is extremely easy to setup, cost effective and many more. I dont think I will use any other cloud provider other than Linode at least for my personal projects. Now that I have established my love for Linode, let&rsquo;s get started shall we?"/>



<link rel="stylesheet" href="https://diabhey.github.io/fontawesome/css/all.min.css" />

<link
  id="dark-mode-theme"
  rel="stylesheet"
  href="https://diabhey.github.io/css/dark.css"
/>

<script>
  var darkTheme = document.getElementById('dark-mode-theme')
  var storedTheme = localStorage.getItem('dark-mode-storage')
  if (storedTheme === 'dark') {
    darkTheme.disabled = false
  } else if (storedTheme === 'light') {
    darkTheme.disabled = true
  }
</script>

<script src="https://diabhey.github.io/js/bundle.js"></script>
<script src="https://diabhey.github.io/js/instantpage.min.js" type="module" defer></script>
<meta name="generator" content="Hugo 0.79.1" />
  </head>
  <body>
    
  




  <header>
    <nav class="navbar">
  <div class="nav">
    
        <a href="https://diabhey.github.io/" class="nav-logo">
        <img
          src="https://diabhey.github.io/images/icon.png"
          width="50"
          height="50"
          alt="Logo"
        />
        </a>
    

    <ul class="nav-links">
      
        
          <li>
            <a href="/about/" id="About"
              ><em class="fas fa-user fa-lg"></em
            ></a>
          </li>
          
      
        
          <li>
            <a href="/podcasts/" id="podcasts"
              ><em class="fas fa-podcast fa-lg"></em
            ></a>
          </li>
          
      
        
          <li>
            <a href="/tags" id="Tags"
              ><em class="fas fa-tag fa-lg"></em
            ></a>
          </li>
          
      
        
          <li>
            <a href="/categories" id="Category"
              ><em class="fas fa-folder fa-lg"></em
            ></a>
          </li>
          
      
    </ul>
  </div>
</nav>

    <div class="intro-header">
      <div class="container">
        <div class="post-heading">
          
            <h1>
              Setup K8s cluster using LKE and Terraform
            </h1>
          
          
            <span class="meta-post">
  <em class="fa fa-calendar-alt"></em
  >&nbsp;May 1, 2021
  
    &nbsp;&nbsp;&nbsp;<em class="fa fa-folder-open"></em>&nbsp;
    
      <a href="https://diabhey.github.io/categories/iac/">IaC</a
      >&nbsp;
    
  
</span>

          
        </div>
      </div>
    </div>
  </header>
  

    
  <div class="container" role="main">
    <article class="article" class="blog-post">
      
  <p>In this blog post, I&rsquo;ll demonstrate how I am using Linode Kubernetes Engine(<a href="https://www.linode.com/products/kubernetes/">LKE</a>) and <a href="https://www.terraform.io/">Terraform</a> to setup the infrastructure for Hivenetes (a personal project that I am working on). I chose Linode as the cloud provider as it is extremely easy to setup, cost effective and many more. I dont think I will use any other cloud provider other than Linode at least for my personal projects. Now that I have established my love for Linode, let&rsquo;s get started shall we?</p>
<p><!-- raw HTML omitted --><em>Before you begin</em><!-- raw HTML omitted --></p>
<p>Make sure you have the following setup,</p>
<ul>
<li>Linode account (Note: Using LKE is not free)</li>
<li>Terraform installed</li>
</ul>
<h2 id="setting-up-your-workspace">Setting up your workspace</h2>
<ul>
<li>
<p>Generate your Linode API Token by following these <a href="https://www.linode.com/docs/guides/getting-started-with-the-linode-api/#get-an-access-token">steps</a> and save them in a secure place.</p>
</li>
<li>
<p>Clone the <a href="https://github.com/hivenetes/apiculture">hivenetes/apiculture</a> repository</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone https://github.com/hivenetes/apiculture.git <span style="color:#f92672">&amp;&amp;</span> cd apiculture/lke_cluster
</code></pre></div></li>
</ul>
</li>
<li>
<p>Initial directory setup should be like this,</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">   ├── hivenetes.tf            <span style="color:#75715e"># Main Configuration File</span>
    ── linode_types.json       <span style="color:#75715e"># List of Linode Types - Pricing and Specs</span>
   └── variables.tf            <span style="color:#75715e"># Variables used in hivenetes.tf</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p>Create a <em>terraform.tfvars</em> file with the following content,</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#75715e"># This just an example</span>
<span style="color:#ae81ff">label = &#34;hivenetes&#34;</span>
<span style="color:#ae81ff">k8s_version = &#34;1.19&#34;</span>
<span style="color:#ae81ff">region = &#34;eu-central&#34;</span>
<span style="color:#ae81ff">pools = [</span>
  {
    <span style="color:#75715e"># Type can be found from linode_types.json</span>
    <span style="color:#f92672">type </span>: <span style="color:#e6db74">&#34;g6-standard-2&#34;</span> 
    <span style="color:#f92672">count </span>: <span style="color:#ae81ff">3</span>
  },
]
</code></pre></div></li>
</ul>
</li>
<li>
<p>Create a <em>secret.tfvars</em> file that holds the API Token</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#ae81ff">token = &#34;&lt;your linode api token&gt;&#34;</span>
</code></pre></div></li>
</ul>
</li>
</ul>
<h2 id="time-to-launch">Time to launch</h2>
<p>Open a terminal and execute the following,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Initialise terraform</span>
terraform init
<span style="color:#75715e"># View your terraform plan</span>
terraform plan -var-file<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;secret.tfvars&#34;</span>
<span style="color:#75715e"># Apply the plan</span>
terraform apply -var-file<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;secret.tfvars&#34;</span>
<span style="color:#75715e"># After a few minutes, you will see the outputs being displayed on the terminal</span>
</code></pre></div><h3 id="connecting-to-lke-cluster">Connecting to LKE cluster</h3>
<p>Open a terminal and execute the following,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Saving the cluster configuration to hivenetes-config.yaml</span>
export KUBE_VAR<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>terraform output kubeconfig<span style="color:#e6db74">`</span> <span style="color:#f92672">&amp;&amp;</span> sed -e <span style="color:#e6db74">&#39;s/^&#34;//&#39;</span> -e <span style="color:#e6db74">&#39;s/&#34;$//&#39;</span> <span style="color:#f92672">&lt;&lt;&lt;</span><span style="color:#e6db74">&#34;</span>$KUBE_VAR<span style="color:#e6db74">&#34;</span> | base64 -d &gt; hivenetes-config.yaml
<span style="color:#75715e"># Add the kubeconfig file to your $KUBECONFIG environment variable</span>
export KUBECONFIG<span style="color:#f92672">=</span>hivenetes-config.yaml
</code></pre></div><p>You can now begin interacting with your cluster using kubectl</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># To list all your LKE Nodes</span>
kubectl get nodes
</code></pre></div><p>Note: I use <a href="https://github.com/kubermatic/fubectl">fubectl</a> to interact with k8s as it makes my life way easier. I encourage you to check it out. If  you are using microk8s then you can use <a href="https://github.com/diabhey/fubectl">microk8s fubectl</a>, an microk8s adapted version that I made.</p>
<h2 id="cleanup">Cleanup</h2>
<p>Make sure to clean up and destroy your clusters after using as you will be charged based on your usage.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Bye Bye Hivenetes</span>
terraform destroy
</code></pre></div><p>Now that is how simple and easy it is to spin up a Kubernetes cluster on Linode.</p>




      
        <div class="blog-tags">
          
            <a href="https://diabhey.github.io/tags/terraform/">Terraform</a
            >&nbsp;
          
            <a href="https://diabhey.github.io/tags/kubernetes/">Kubernetes</a
            >&nbsp;
          
        </div>
      
    </article>
    
    
  </div>

    <footer>
  
  <div>
    
      <a href="https://linkedin.com/in/abhimanyuselvan" name="linkedin-in"
        ><em class="fab fa-linkedin-in"></em
      ></a>
    
      <a href="https://github.com/diabhey" name="github"
        ><em class="fab fa-github"></em
      ></a>
    
      <a href="https://twitter.com/diabhey" name="twitter"
        ><em class="fab fa-twitter"></em
      ></a>
    




  
  <div class="container">
    <p class="credits copyright">
      <a href="https://diabhey.github.io/about">Abhimanyu Selvan</a>
      &nbsp;&copy;
      2021
      
        &nbsp;/&nbsp;
        <a href="https://diabhey.github.io/">CloudOdyssey</a>
      
      &nbsp;&ndash;&nbsp;
      <em class="fas fa-moon" id="dark-mode-toggle"></em>
    </p>

    <p class="credits theme-by">
      Powered By <a href="https://gohugo.io">Hugo</a>&nbsp;
      Theme
      <a href="https://github.com/matsuyoshi30/harbor">Harbor</a>
    </p>
  </div>
</footer>

  </body>
</html>
