<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<title>Remote Server Monitoring and Observability</title>


  



<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link
  rel="alternate"
  type="application/rss+xml"
  href="https://diabhey.github.io/index.xml"
  title="CloudOdyssey"
/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Remote Server Monitoring and Observability"/>
<meta name="twitter:description" content="Here is a bit of a back story for the readers to understand the context better. We have our software(microservices) running on linux servers that will deployed across the globe. We also have our cloud platform through which we gain insights on our software[ more on that in a later blog] but that lacks the node and container metrics we need to monitor our servers. Due to the nature of the business, we have limted/restricted access to the client&rsquo;s network."/>



<link rel="stylesheet" href="https://diabhey.github.io/fontawesome/css/all.min.css" />

<link
  id="dark-mode-theme"
  rel="stylesheet"
  href="https://diabhey.github.io/css/dark.css"
/>

<script>
  var darkTheme = document.getElementById('dark-mode-theme')
  var storedTheme = localStorage.getItem('dark-mode-storage')
  if (storedTheme === 'dark') {
    darkTheme.disabled = false
  } else if (storedTheme === 'light') {
    darkTheme.disabled = true
  }
</script>

<script src="https://diabhey.github.io/js/bundle.js"></script>
<script src="https://diabhey.github.io/js/instantpage.min.js" type="module" defer></script>
<meta name="generator" content="Hugo 0.79.1" />
  </head>
  <body>
    
  




  <header>
    <nav class="navbar">
  <div class="nav">
    
        <a href="https://diabhey.github.io/" class="nav-logo">
        <img
          src="https://diabhey.github.io/images/icon.png"
          width="50"
          height="50"
          alt="Logo"
        />
        </a>
    

    <ul class="nav-links">
      
        
          <li>
            <a href="/about/" id="About"
              ><em class="fas fa-user fa-lg"></em
            ></a>
          </li>
          
      
        
          <li>
            <a href="/podcasts/" id="podcasts"
              ><em class="fas fa-podcast fa-lg"></em
            ></a>
          </li>
          
      
        
          <li>
            <a href="/tags" id="Tags"
              ><em class="fas fa-tag fa-lg"></em
            ></a>
          </li>
          
      
        
          <li>
            <a href="/categories" id="Category"
              ><em class="fas fa-folder fa-lg"></em
            ></a>
          </li>
          
      
    </ul>
  </div>
</nav>

    <div class="intro-header">
      <div class="container">
        <div class="post-heading">
          
            <h1>
              Remote Server Monitoring and Observability
            </h1>
          
          
            <span class="meta-post">
  <em class="fa fa-calendar-alt"></em
  >&nbsp;Apr 12, 2021
  
    &nbsp;&nbsp;&nbsp;<em class="fa fa-folder-open"></em>&nbsp;
    
      <a href="https://diabhey.github.io/categories/cloud/">cloud</a
      >&nbsp;
    
  
</span>

          
        </div>
      </div>
    </div>
  </header>
  

    
  <div class="container" role="main">
    <article class="article" class="blog-post">
      
  <p>Here is a bit of a back story for the readers to understand the context better. We have our software(microservices) running on linux servers that will deployed across the globe. We also have our cloud platform through which we gain insights on our software[ more on that in a later blog] but that lacks the node and container metrics we need to monitor our servers. Due to the nature of the business, we have limted/restricted access to the client&rsquo;s network. Based on the requirements and other factors we decided to side with open source tools and frameworks that will better integrate into our system.</p>
<p>Thanks to <a href="https://prometheus.io/">Prometheus</a>, all the heavy-lifting is done for us.  In this post, I will run through a series of steps that is required to  setup Prometheus on a Linux server and then go ahead and setup <a href="https://grafana.com/products/cloud/">Grafana Cloud</a> as our observability platform through which can intuitively gain insights from our data sources across the globe.</p>
<h3 id="requirements">Requirements</h3>
<ul>
<li><a href="https://grafana.com/docs/grafana-cloud/quickstart/">Grafana Cloud Account</a></li>
<li>Access to Linux Server(Node)</li>
</ul>
<h3 id="set-up-prometheus-node-exporter-and-cadvisor">Set up Prometheus, Node Exporter and cAdvisor</h3>
<p>Firstly, we will need to setup the <a href="https://github.com/prometheus/node_exporter">node_exporter</a> that is responsible for collecting the prometheus metrics and sending it to the grafana cloud and then install prometheus on the node and even run them as a systemd service. One can find the instructions to set it up on this <a href="https://grafana.com/docs/grafana-cloud/quickstart/agent_linuxnode/">page</a>.  In case you want to run the services as docker containers, look no further.  We will also be using <a href="https://hub.docker.com/r/google/cadvisor/">cAdvisor</a>(Container Advisor) that collects the container performance metrics.</p>
<p>Let&rsquo;s open a terminal and do the following shall we?,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Create a node_monitor directory on the node where you are running the monitoring services</span>
mkdir ~/node_monitor <span style="color:#f92672">&amp;&amp;</span> cd node_monitor
<span style="color:#75715e"># Create a docker-compose file to setup the services</span>
touch docker-compose.yml
<span style="color:#75715e"># Create a prometheus directory to store the config </span>
mkdir prometheus <span style="color:#f92672">&amp;&amp;</span> cd prometheus
<span style="color:#75715e"># Create the config file</span>
touch prometheus.yml
</code></pre></div><h4 id="configure-prometheus">Configure Prometheus</h4>
<p>Now we need to configure prometheus to publish the metrics to grafana cloud. For that, we need to edit the contents of the <code>prometheus.yml</code> with the following,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">global</span>:
  <span style="color:#f92672">scrape_interval</span>: <span style="color:#ae81ff">15s</span>
  <span style="color:#f92672">evaluation_interval</span>: <span style="color:#ae81ff">15s</span>

<span style="color:#f92672">scrape_configs</span>:
  - <span style="color:#f92672">job_name</span>: <span style="color:#ae81ff">node</span>
    <span style="color:#f92672">static_configs</span>:
    - <span style="color:#f92672">targets</span>: [<span style="color:#e6db74">&#39;localhost:9090&#39;</span>,<span style="color:#e6db74">&#39;cadvisor:8080&#39;</span>,<span style="color:#e6db74">&#39;node-exporter:9100&#39;</span>]

<span style="color:#f92672">remote_write</span>:
  - <span style="color:#f92672">url</span>: <span style="color:#ae81ff">https://prometheus-us-central1.grafana.net/api/prom/push</span>
    <span style="color:#f92672">basic_auth</span>:
      <span style="color:#f92672">username</span>: <span style="color:#e6db74">&#34;your grafana username&#34;</span>
      <span style="color:#f92672">password</span>: <span style="color:#e6db74">&#34;your Grafana API key&#34;</span>
</code></pre></div><p>Save the file and we shall come back to it shortly. The grafana <code>username</code> and <code>password</code> need to be created in order to visualize the data on the grafana dashboard.</p>
<ul>
<li>
<p>Let&rsquo;s login into grafana cloud portal and create a stack.</p>
</li>
<li>
<p>The instance will be created shortly and an <strong>url</strong> will be generated through which we can access our grafana enterprise stack.</p>
</li>
<li>
<p>Copy the Prometheus <strong>remote_write</strong> Configuration generated and add it to the <code>prometheus.yml</code> file we had created earlier.  Save the file and exit.</p>
</li>
</ul>
<h4 id="create-the-monitoring-services">Create the monitoring services</h4>
<p>â€‹Add the following contents to the <code>docker-compose.yml</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;3&#39;</span>
<span style="color:#f92672">services</span>:
  <span style="color:#f92672">prometheus</span>:
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">prom/prometheus:latest</span>
    <span style="color:#f92672">ports</span>:
      - <span style="color:#ae81ff">9000</span>:<span style="color:#ae81ff">9090</span>
    <span style="color:#f92672">volumes</span>:
      - <span style="color:#ae81ff">./prometheus:/etc/prometheus</span>
      - <span style="color:#ae81ff">prometheus-data:/prometheus</span>
    <span style="color:#f92672">command</span>: --<span style="color:#ae81ff">web.enable-lifecycle  --config.file=/etc/prometheus/prometheus.yml    </span>

    <span style="color:#f92672">expose</span>:
      - <span style="color:#ae81ff">9090</span>
    <span style="color:#f92672">ports</span>:
      - <span style="color:#ae81ff">9090</span>:<span style="color:#ae81ff">9090</span>
    <span style="color:#f92672">links</span>:
      - <span style="color:#ae81ff">cadvisor:cadvisor</span>
      - <span style="color:#ae81ff">node-exporter:node-exporter</span>

  <span style="color:#f92672">node-exporter</span>:
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">prom/node-exporter:latest</span>
    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">monitoring_node_exporter</span>
    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">unless-stopped</span>
    <span style="color:#f92672">expose</span>:
      - <span style="color:#ae81ff">9100</span>

  <span style="color:#f92672">cadvisor</span>:
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">google/cadvisor:latest</span>
    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">monitoring_cadvisor</span>
    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">unless-stopped</span>
    <span style="color:#f92672">volumes</span>:
      - <span style="color:#ae81ff">/:/rootfs:ro</span>
      - <span style="color:#ae81ff">/var/run:/var/run:rw</span>
      - <span style="color:#ae81ff">/sys:/sys:ro</span>
      - <span style="color:#ae81ff">/var/lib/docker/:/var/lib/docker:ro</span>
    <span style="color:#f92672">expose</span>:
      - <span style="color:#ae81ff">8080</span>

<span style="color:#f92672">volumes</span>:
  <span style="color:#f92672">prometheus-data</span>:
</code></pre></div><p>Launch the services by running the following,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker-compose -f docker-compose.yml up -d
</code></pre></div><p>At this point, we have all the necessary services in place to start visualizing the data from the nodes.</p>
<h3 id="grafana-cloud">Grafana Cloud</h3>
<ul>
<li>
<p>Login into the <code>https://&lt;your stack&gt;.grafana.net</code> and select the data source as the prometheus instance that we had created earlier. This step is needed to visualise the data being published from the nodes. You can now create your own dashboard to monitor the metrics of your choice or import <a href="https://grafana.com/grafana/dashboards">exisitng dashboards</a>.</p>
</li>
<li>
<p>For this demo, I have imported the Node Exporter Quickstart Dashboard (<strong>id: 13978</strong>) and also the Docker and System Monitoring Dashboard(<strong>id: 893</strong>)</p>
</li>
</ul>
<p>There you have it. Feel free to configure and play with these tools as they have much more to offer.</p>




      
        <div class="blog-tags">
          
            <a href="https://diabhey.github.io/tags/monitoring/">monitoring</a
            >&nbsp;
          
            <a href="https://diabhey.github.io/tags/observability/">observability</a
            >&nbsp;
          
        </div>
      
    </article>
    
    
  </div>

    <footer>
  
  <div>
    
      <a href="https://linkedin.com/in/abhimanyuselvan" name="linkedin-in"
        ><em class="fab fa-linkedin-in"></em
      ></a>
    
      <a href="https://github.com/diabhey" name="github"
        ><em class="fab fa-github"></em
      ></a>
    
      <a href="https://twitter.com/diabhey" name="twitter"
        ><em class="fab fa-twitter"></em
      ></a>
    




  
  <div class="container">
    <p class="credits copyright">
      <a href="https://diabhey.github.io/about">Abhimanyu Selvan</a>
      &nbsp;&copy;
      2021
      
        &nbsp;/&nbsp;
        <a href="https://diabhey.github.io/">CloudOdyssey</a>
      
      &nbsp;&ndash;&nbsp;
      <em class="fas fa-moon" id="dark-mode-toggle"></em>
    </p>

    <p class="credits theme-by">
      Powered By <a href="https://gohugo.io">Hugo</a>&nbsp;
      Theme
      <a href="https://github.com/matsuyoshi30/harbor">Harbor</a>
    </p>
  </div>
</footer>

  </body>
</html>
